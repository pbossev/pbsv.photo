/**
 * Cloudflare Pages Function for Gallery Authentication
 * Returns actual image URLs only if password is correct
 */

// GALLERY CONFIGURATION - Generated by generate-worker-config.js
// Each line marked with #ignore will be excluded from version control
const GALLERY_PASSWORDS = {
  "10_16_2025_andrew_aldo": "koreanitalian", // #ignore
};
const GALLERY_IMAGES = {
  "10_16_2025_andrew_aldo": [{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0422__w5257h3505.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0422_preview__w600h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0429__w3447h5171.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0429_preview__w266h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0433__w5568h3712.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0433_preview__w600h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0426__w5568h3712.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0426_preview__w600h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0446__w5568h3712.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0446_preview__w600h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0420__w5568h3712.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0420_preview__w600h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0437__w5568h3712.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0437_preview__w600h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0439__w5568h3712.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0439_preview__w600h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0448__w3712h5568.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0448_preview__w267h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0442__w3712h5568.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0442_preview__w267h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0449__w5568h3712.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0449_preview__w600h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0470__w3169h4754.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0470_preview__w267h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0474__w3712h5568.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0474_preview__w267h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0453__w5568h3712.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0453_preview__w600h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0456__w5304h3536.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0456_preview__w600h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0480__w3688h5532.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0480_preview__w267h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0483__w3253h4879.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0483_preview__w267h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0456-2__w5304h3536.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0456-2_preview__w600h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0494__w3434h5151.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0494_preview__w267h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0491__w5568h3712.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0491_preview__w600h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0507__w5568h3712.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0507_preview__w600h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0500__w3712h5568.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0500_preview__w267h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0511__w5568h3712.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0511_preview__w600h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0514__w3601h5401.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0514_preview__w267h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0522__w3712h5568.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0522_preview__w267h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0456-3__w5304h3536.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0456-3_preview__w600h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0497__w3434h5151.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0497_preview__w267h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0516__w3643h5464.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0516_preview__w266h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0535__w3469h5203.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0535_preview__w266h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0550__w5568h3712.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0550_preview__w600h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0551__w5568h3712.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0551_preview__w600h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0547__w3538h5307.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0547_preview__w267h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0536__w3290h4935.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0536_preview__w267h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0543__w3712h5568.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0543_preview__w267h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0528__w3559h5338.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0528_preview__w266h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0554__w5568h3712.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0554_preview__w600h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0564__w3370h5055.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0564_preview__w267h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0560__w5526h3684.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0560_preview__w600h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0585__w3712h5568.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0585_preview__w267h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0599__w3457h5185.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0599_preview__w267h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0573__w3712h5568.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0573_preview__w267h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0556__w3611h5417.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0556_preview__w266h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0617__w3645h5468.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0617_preview__w266h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0609__w3712h5568.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0609_preview__w267h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0746__w5485h3657.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0746_preview__w600h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0626__w3712h5568.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0626_preview__w267h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0665__w3643h5464.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0665_preview__w266h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0680__w4386h2924.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0680_preview__w600h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0649__w5568h3712.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0649_preview__w600h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0750__w3672h5508.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0750_preview__w267h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0686__w3367h5050.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0686_preview__w266h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0766__w3489h5234.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0766_preview__w267h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0786__w4678h3119.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0786_preview__w600h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0765__w3711h5567.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0765_preview__w266h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0755__w5543h3695.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0755_preview__w600h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0749__w3488h5232.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0749_preview__w267h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0794__w3487h5231.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0794_preview__w266h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0783__w5477h3081.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0783_preview__w711h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0806-3__w2472h3708.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0806-3_preview__w267h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0806__w4441h2961.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0806_preview__w600h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0673__w3645h5467.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0673_preview__w266h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0799__w3712h5568.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0799_preview__w267h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0791__w5420h3049.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0791_preview__w711h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0795__w3693h5539.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0795_preview__w266h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0806-2__w4441h2961.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0806-2_preview__w600h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0855__w3367h5051.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0855_preview__w266h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0842__w3586h5379.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0842_preview__w267h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0854__w3382h5073.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0854_preview__w266h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0816__w3712h5568.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0816_preview__w267h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0856__w3675h5512.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0856_preview__w266h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0826__w5482h3655.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0826_preview__w601h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0813__w5568h3712.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0813_preview__w600h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0867__w5220h3480.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0867_preview__w600h400.webp"},{"url":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0822__w5568h3712.jpg","preview":"https://r2.pbsv.photo/events/10_16_2025_andrew_aldo/DSC_0822_preview__w600h400.webp"}], // #ignore
};

export async function onRequest(context) {
  const { request } = context;
  const corsHeaders = {
    'Access-Control-Allow-Origin': '*',
    'Access-Control-Allow-Methods': 'POST, OPTIONS',
    'Access-Control-Allow-Headers': 'Content-Type',
  };

  // Handle CORS preflight
  if (request.method === 'OPTIONS') {
    return new Response(null, { headers: corsHeaders });
  }

  if (request.method !== 'POST') {
    return new Response(JSON.stringify({ error: 'Method not allowed' }), {
      status: 405,
      headers: { ...corsHeaders, 'Content-Type': 'application/json' }
    });
  }

  try {
    const { password, galleryPath } = await request.json();

    if (!password || !galleryPath) {
      return new Response(JSON.stringify({ error: 'Password and gallery path required' }), {
        status: 400,
        headers: { ...corsHeaders, 'Content-Type': 'application/json' }
      });
    }

    // Check if gallery exists
    const galleryPassword = GALLERY_PASSWORDS[galleryPath];

    if (!galleryPassword) {
      return new Response(JSON.stringify({ error: 'Gallery not found' }), {
        status: 404,
        headers: { ...corsHeaders, 'Content-Type': 'application/json' }
      });
    }

    if (galleryPassword !== password) {
      return new Response(JSON.stringify({ error: 'Invalid password' }), {
        status: 401,
        headers: { ...corsHeaders, 'Content-Type': 'application/json' }
      });
    }

    // Password correct - return image data
    const galleryImages = GALLERY_IMAGES[galleryPath];

    if (!galleryImages) {
      return new Response(JSON.stringify({ error: 'No images found for this gallery' }), {
        status: 404,
        headers: { ...corsHeaders, 'Content-Type': 'application/json' }
      });
    }

    return new Response(JSON.stringify({
      success: true,
      images: galleryImages
    }), {
      headers: { ...corsHeaders, 'Content-Type': 'application/json' }
    });

  } catch (error) {
    console.error('Auth error:', error);
    return new Response(JSON.stringify({ error: 'Internal server error' }), {
      status: 500,
      headers: { ...corsHeaders, 'Content-Type': 'application/json' }
    });
  }
}
